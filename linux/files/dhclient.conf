{# Macro definition #}
{%- macro render_section(section) -%}
{%- if section.backoff_cutoff is defined %}
backoff-cutoff {{ section.backoff_cutoff|default(15, true) }};
{%- endif %}

{%- if section.initial_interval is defined %}
initial-interval {{ section.initial_interval|default(10, true) }};
{%- endif %}

{%- if section.link_timeout is defined %}
link-timeout {{ section.link_timeout|default(10, true) }};
{%- endif %}

{%- if section.reboot is defined %}
# The reboot statement sets the time that must elapse after the client
# first tries to reacquire its old address before it gives up and tries
# to discover a new address.
reboot {{ section.reboot|default(10, true) }};
{%- endif %}

{%- if section.retry is defined %}
retry {{ section.retry|default(60, true) }};
{%- endif %}

{%- if section.select_timeout is defined %}
# The select-timeout is the time after the client sends its first lease
# discovery request at which it stops waiting for offers from servers,
# assuming that it has received at least one such offer
select-timeout {{ section.select_timeout|default(0, True) }};
{%- endif %}

{%- if section.timeout is defined %}
timeout {{ section.timeout|default(120, True) }};
{%- endif %}

{%- if section.send is defined and section.send|length > 0 %}
{% for item in section.send %}
send {{ item.option }} {{ item.declaration }};
{%- endfor %}
{%- endif %}

{%- if section.supersede is defined and section.supersede|length > 0 %}
{% for item in section.supersede %}
supersede {{ item.option }} {{ item.declaration }};
{%- endfor %}
{%- endif %}

{%- if section.prepend is defined and section.prepend|length > 0 %}
{% for item in section.prepend %}
prepend {{ item.option }} {{ item.declaration }};
{%- endfor %}
{%- endif %}

{%- if section.append is defined and section.append|length > 0 %}
{% for item in section.append %}
append {{ item.option }} {{ item.declaration }};
{%- endfor %}
{%- endif %}

{%- if section.reject is defined and section.reject|length > 0 %}
reject {{ section.reject|join(",\n    ") }};
{%- endif %}

{%- if section.request is defined and section.request|length > 0 %}
request {{ section.request|join(",\n    ") }};
{% endif %}

{%- if section.require is defined and section.require|length > 0 %}
require {{ section.require|join(",\n    ") }};
{% endif -%}
{%- endmacro -%}
{# Actual template start #}
{%- from "linux/map.jinja" import network with context -%}
{%- set dhclient = network.get('dhclient_config', {}) %}
# dhclient.conf(5) file managed by salt-minion(1)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

option rfc3442-classless-static-routes code 121 = array of unsigned integer 8;
{{ render_section(dhclient) }}

{% for iface_name, options in dhclient.interface.iteritems() %}
{%- if network.interface[iface_name] is defined and network.interface.get(iface_name).enabled == True
   and network.interface.get(iface_name).proto == 'dhcp' -%}

interface "{{ iface_name }}" {
    {{ render_section(options)|indent }}
}
{%- endif -%}
{%- endfor %}
